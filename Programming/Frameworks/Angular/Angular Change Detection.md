16-03-2023
16:54
Authors: 
***
Tags: #stub #angular 
***
# Change Detection

### Механизм

**Отслеживание изменений** - это механизм в Angular, который отвечает за изменение выражений в шаблонах (html) при их изменении в моделях (ts).

Механизм запускается каждый раз, когда, например, инициируется одно из браузерных событий, выполняются HTTP-запросы или вызывается функция `setTimeout()` или `setInterval()`.

В случае с браузерными событиями, Angular расширяет стандартный метод `addEventListener()`, добавляя после вызова "оригинального" обработчика события запуск отслеживания изменений.

На самом деле ключевую роль здесь играет библиотека `zone.js`. В Angular с ее помощью все приложение разделяется на секторы, каждый из которых запоминает контекст асинхронного выполнения. Такой подход после завершения асинхронной операции позволяет запустить механизм отслеживания изменений в нужном секторе.

Запуск механизма `ChangeDetection` в родительском компоненте автоматически инициирует запуск механизма во всех дочерних компонентах.

---

### Default

Механизм отслеживания изменений запускается при любом действии пользователя или изменения состояния приложения (input'ы, поля класса, любое значение крч)

---

### OnPush

Указывается в основном для компонентов, которые необходимы для отображения каких либо статичных данных. Вызывается только при ngOnChanges и при изменении input'ов. Позволяет снизить нагрузку, так как реже вызывается.

---

### ChangeDetectorRef

В библиотеке `@angular/core` есть сервис `ChangeDetectorRef`. Он позволяет взять управление механизмом отслеживания изменений полностью под свой контроль.

Основные методы сервиса:

-   `detach()` - полностью отключает механизм `ChangeDetection`;
-   `detectChanges()` - принудительно запускает механизм отслеживания изменений;
-   `reattach()` - используется после вызова `detach()` для активации механизма `ChangeDetection`.

